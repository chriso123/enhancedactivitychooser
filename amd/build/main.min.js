define(["jquery","core/str","core/modal_factory","core/templates","core/ajax"],function(a,b,c,d,e){return{init:function(){var f,g=0,h=function(a){return e.call([{methodname:"local_activitychooser_toggle_starred",args:{activityid:a}}])[0].then(function(){return i(g)}).then(function(a){return d.render("local_activitychooser/modulechooser",a)}).then(function(a){f.setBody(a)})},i=function(a){return e.call([{methodname:"local_activitychooser_get_activites",args:{sectionnum:a}}])[0].then(function(a){var b=function(a,b){var c=[],d=[];return a.forEach(function(a){d.length<b?d.push(a):(c.push(d),d=[a])}),d.length>0&&c.push(d),c},a=JSON.parse(a),c=b(a.all,2),d=b(a.recommended,2),e=b(a.starred,4);return{allRows:c,recommendedRows:d,starredRows:e}})};b.get_string("addresourceoractivity").then(function(b){var d='<button class="alternative-modchooser btn link"><i class="icon fa fa-plus fa-fw "></i>'+b+"</button>";a(".section-modchooser-link").parent().append(d);var e=b,f="<div></div>";return c.create({type:c.types.DEFAULT,title:e,body:f,large:!0})}).then(function(b){f=b,a(".alternative-modchooser").click(function(){var c=a(this).closest("li.section").attr("id").split("-")[1];b.show(),g=c,i(c).then(function(a){var c=d.render("local_activitychooser/modulechooser",a);b.setBody(c)})})}),a("body").on("click",".activitychooser-modal-body .row .toggle-favourite",function(){var b=a(this).data("id");h(b)})}}});